"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1001],{1001:(F,v,a)=>{a.r(v),a.d(v,{SolicitarvisitaPageModule:()=>M,routes:()=>D});var h=a(177),r=a(4341),g=a(7125),d=a(6454),i=a(7073),u=a(9498);const _=[{path:"",component:i.SolicitarvisitaPage}];let E=(()=>{var n;class l{}return(n=l).\u0275fac=function(e){return new(e||n)},n.\u0275mod=u.$C({type:n}),n.\u0275inj=u.G2t({imports:[d.iI.forChild(_),d.iI]}),l})();const D=[{path:"",loadComponent:()=>Promise.resolve().then(a.bind(a,7073)).then(n=>n.SolicitarvisitaPage)}];let M=(()=>{var n;class l{}return(n=l).\u0275fac=function(e){return new(e||n)},n.\u0275mod=u.$C({type:n}),n.\u0275inj=u.G2t({imports:[h.MD,r.YN,g.bv,E]}),l})()},7073:(F,v,a)=>{a.r(v),a.d(v,{SolicitarvisitaPage:()=>m});var h=a(467),r=a(7125),g=a(177),d=a(4341),i=a(9498),u=a(2872),_=a(6454),E=a(8472),D=a(8152);function M(e,p){if(1&e&&i.nrm(0,"ion-icon",12),2&e){const s=i.XpG().$implicit;i.Y8G("name",s.icono)}}function n(e,p){if(1&e&&(i.j41(0,"ion-col",10)(1,"ion-chip"),i.DNE(2,M,1,1,"ion-icon",11),i.j41(3,"ion-label"),i.EFF(4),i.k0s()()()),2&e){const s=p.$implicit;i.R7$(2),i.Y8G("ngIf",s.icono),i.R7$(2),i.JRh(s.nombre)}}function l(e,p){if(1&e){const s=i.RV6();i.j41(0,"div")(1,"ion-item")(2,"ion-label"),i.EFF(3,"Fecha"),i.k0s(),i.j41(4,"ion-datetime",13),i.mxI("ngModelChange",function(t){i.eBV(s);const c=i.XpG();return i.DH7(c.fecha,t)||(c.fecha=t),i.Njj(t)}),i.k0s()(),i.j41(5,"ion-item")(6,"ion-label"),i.EFF(7,"Hora"),i.k0s(),i.j41(8,"ion-datetime",14),i.mxI("ngModelChange",function(t){i.eBV(s);const c=i.XpG();return i.DH7(c.hora,t)||(c.hora=t),i.Njj(t)}),i.k0s()(),i.j41(9,"ion-button",15),i.bIt("click",function(){i.eBV(s);const t=i.XpG();return i.Njj(t.confirmarCita())}),i.EFF(10," Confirmar "),i.k0s()()}if(2&e){const s=i.XpG();i.R7$(4),i.R50("ngModel",s.fecha),i.R7$(4),i.R50("ngModel",s.hora)}}let m=(()=>{var e;class p{constructor(o,t,c,f,P,S){this.navCtrl=o,this.router=t,this.toastController=c,this.activatedRoute=f,this.authService=P,this.auth=S,this.propiedad={},this.mostrarFormulario=!1,this.fecha="",this.hora="",this.idPropiedad=""}ngOnInit(){const o=localStorage.getItem("userData");if(!o)return void this.navCtrl.navigateRoot("/login");const t=JSON.parse(o);t&&"quiero-rentar"===t.userType?this.activatedRoute.queryParams.subscribe(c=>{this.idPropiedad=c.id,console.log("ID recibido en solicitarvisita:",this.idPropiedad),this.idPropiedad&&this.getPropertyData()}):this.navCtrl.navigateRoot("/login")}getPropertyData(){var o=this;return(0,h.A)(function*(){try{const t=yield o.authService.getPropertyById(o.idPropiedad);t?(o.propiedad={id:o.idPropiedad,...t},o.propiedad.servicios&&!Array.isArray(o.propiedad.servicios)&&(o.propiedad.servicios=o.convertirServiciosAArray(o.propiedad.servicios)),console.log("Propiedad obtenida:",o.propiedad)):console.log("No se encontr\xf3 la propiedad con el id:",o.idPropiedad)}catch(t){console.error("Error al obtener la propiedad:",t)}})()}convertirServiciosAArray(o){return Object.keys(o).map(t=>({nombre:t,icono:!0===o[t]?t:o[t]}))}solicitarVisita(){this.mostrarFormulario=!0}confirmarCita(){var o=this;return(0,h.A)(function*(){if(!o.fecha||!o.hora)return void alert("Por favor, selecciona una fecha y hora.");const t=o.auth.currentUser;if(!t)return void alert("Debes iniciar sesi\xf3n para solicitar una cita.");const c=t.uid,f=o.propiedad.ownerId;if(f)try{yield o.authService.createCita(f,c,o.idPropiedad,o.fecha,o.hora),yield(yield o.toastController.create({message:"El arrendatario est\xe1 por confirmar tu visita.",duration:3e3,position:"top",color:"success"})).present(),o.router.navigate(["/search"])}catch(P){console.error("Error al crear la cita:",P),yield(yield o.toastController.create({message:"Ocurri\xf3 un error al crear la cita. Por favor, int\xe9ntalo de nuevo.",duration:3e3,position:"top",color:"danger"})).present()}else alert("No se encontr\xf3 el ID del propietario en la propiedad.")})()}}return(e=p).\u0275fac=function(o){return new(o||e)(i.rXU(u.q9),i.rXU(_.Ix),i.rXU(r.K_),i.rXU(_.nX),i.rXU(E.u),i.rXU(D.Nj))},e.\u0275cmp=i.VBU({type:e,selectors:[["app-solicitarvisita"]],decls:28,vars:5,consts:[["color","primary"],[1,"ion-padding"],[1,"container"],[1,"info-card"],[1,"titulo"],["size","6","size-md","4",4,"ngFor","ngForOf"],[1,"info"],["name","location-outline"],["expand","full","color","primary",3,"click"],[4,"ngIf"],["size","6","size-md","4"],[3,"name",4,"ngIf"],[3,"name"],["display-format","YYYY-MM-DD","presentation","date",3,"ngModelChange","ngModel"],["display-format","HH:mm","picker-format","HH:mm","presentation","time",3,"ngModelChange","ngModel"],["expand","full","color","success",3,"click"]],template:function(o,t){1&o&&(i.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),i.EFF(3,"Detalles de la Propiedad"),i.k0s()()(),i.j41(4,"ion-content",1)(5,"div",2)(6,"ion-card",3)(7,"ion-card-content")(8,"h2",4),i.EFF(9,"Servicios"),i.k0s(),i.j41(10,"ion-grid")(11,"ion-row"),i.DNE(12,n,5,2,"ion-col",5),i.k0s()(),i.j41(13,"h3",4),i.EFF(14,"Especificaciones"),i.k0s(),i.j41(15,"p"),i.EFF(16),i.k0s(),i.j41(17,"div",6),i.nrm(18,"ion-icon",7),i.j41(19,"p"),i.EFF(20),i.k0s()(),i.j41(21,"h3",4),i.EFF(22,"Total: "),i.j41(23,"strong"),i.EFF(24),i.k0s()(),i.j41(25,"ion-button",8),i.bIt("click",function(){return t.solicitarVisita()}),i.EFF(26," Solicitar Visita "),i.k0s(),i.DNE(27,l,11,2,"div",9),i.k0s()()()()),2&o&&(i.R7$(12),i.Y8G("ngForOf",t.propiedad.servicios),i.R7$(4),i.JRh(t.propiedad.especificaciones_adicionales||"Descripci\xf3n no disponible"),i.R7$(4),i.JRh(t.propiedad.direccion||"Direcci\xf3n no especificada"),i.R7$(4),i.SpI("$",t.propiedad.precio||"0","/mes"),i.R7$(3),i.Y8G("ngIf",t.mostrarFormulario))},dependencies:[r.bv,r.Jm,r.b_,r.I9,r.ZB,r.hU,r.W9,r.A9,r.lO,r.eU,r.iq,r.uz,r.he,r.ln,r.BC,r.ai,r.Je,g.MD,g.Sq,g.bT,d.YN,d.BC,d.vS],encapsulation:2}),p})()}}]);